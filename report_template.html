<html>
<head>
<title>отчёт R_LAUNCH_TIME</title>
<meta http-equiv='Cache-Control' content='private'; charset='utf-8'>
<script type='text/javascript' src='jquery-3.5.0.min.js'></script>

<style>
/* общие стили */
	body {
		background-color: #fff;
		font-family: 'Calibri';
		margin: 0px;
	}

	p {
		font-family: 'Calibri';
		font-size: 1em;
		padding: 0px;
		margin: 0px;
	}

	.title_small {
		font-weight: bold;
		font-size: 1.2em;
		padding-bottom: 12px;
	}

	.text_values {
		font-weight: bold;
	}

	.report_table tr td {
		font-family: 'Calibri';
	}

	.td_padding {
		padding-top: 16px;
	}

	.right_p {
		padding-right: 24px;
	}


/* стиль элементов проигрывателя */
	.btn_change_day {
		background-color: #74b9ff;
		border: 1px solid #444;
		cursor: pointer;
		padding: 2px 4px 2px 4px;
	}.btn_change_day:hover { filter: brightness(1.2); }

	#input_range {
		margin: 0px 5px 0px 5px;
	}

	.inputs {
		background-color: #ffffff;
		border: 1px solid #cecece;
		font-size: 1em;
		font-weight: bold;
		outline-color: #0a30f0;
		padding: 3px;
	}
	
	.btn_blue {
		background: #fff;
		border: solid 3px #0984e3;
		border-radius: 2px;
		color: #0984e3;
		cursor: pointer;
		display: inline-block;
		font-size: 1.1em;
		outline: none;
		padding: 4px 7px 4px 7px;
		user-select: none;
		-moz-user-select: none;
		-webkit-user-select: none;
	}.btn_blue:hover {
		background: #0984e3;
		box-shadow: 5px 5px 30px #888888;
		color: #fff;
	}

	.orange_btn {
		border: solid 3px #d35400 !important;
		color: #d35400 !important;
	}.orange_btn:hover {
		background: #d35400 !important;
		box-shadow: 5px 5px 30px #888888 !important;
		color: #fff !important;
	}


/* шаблоны flex */
	.flex_CFsC {
		display: flex;
		flex-direction: column;
		justify-content: flex-start;
		align-items: center;
	}

	.flex_RCC {
		display: flex;
		flex-direction: row;
		justify-content: center;
		align-items: center;
	}

	.flex_RLC {
		display: flex;
		flex-direction: row;
		justify-content: flex-start;
		align-items: center;
	}


/* стили для слайдов */
	.div_for_slide {
		margin-bottom: 50px;
	}

	.g_cont_d {
		display: none;
		width: 100%;
		height: 100%;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		flex-wrap: nowrap;
	}

	.g_cont_w {
		display: none;
		width: 100%;
		height: 100%;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		flex-wrap: nowrap;
	}

	.gen_f {
		margin: 20px;
	}

	.gen {
		display: inline-block;
		margin: R_GSQUARE_MARGINpx;
		width: R_GSQUARE_SIDEpx;
		height: R_GSQUARE_SIDEpx;
	}.gen:hover { filter: brightness(1.2); }

	.gen_legend {
		display: inline-block;
		width: 10px;
		height: 10px;
	}.gen:hover { filter: brightness(1.2); }

	.gen_legend_one {
		margin-right: 16px;
	}

	.text_legend {
		font-size: 0.9em;
	}

	.div_legend {
		width: 80%;
		display: flex;
		flex-direction: row;
		justify-content: flex-start;
		align-items: center;
	}


/* стиль для всплывающей подсказки */
	.tooltip_block {
		background: white;
		border: 1px solid rgb(230, 230, 230);
		box-shadow: 1px 1px 4px rgba(15,15,15,.6);
		color: rgb(82, 82, 82);
		display: none;
		font-size: 1.1em;
		line-height: 16px;
		padding: 8px;
		position: absolute;
		text-align: center;
		z-index: 99;
	}


/* стиль для кнопки с текстом */
	.button_with_text {
		background: #ffffff;
		border: solid 2px #444444;
		border-radius: 2px;
		color: #444444;
		cursor: pointer;
		display: inline-block;
		font-size: 0.9em;
		outline: none;
		padding: 2px 4px 2px 4px;
		user-select: none;
		-moz-user-select: none;
		-webkit-user-select: none;
	}.button_with_text:hover { filter: brightness(1.2); }

	.button_activated {
		background: #444444 !important;
		color: #ffffff !important;
	}
</style>
</head>


<body>
	
	<div class='tooltip_block'></div>
	
	<!-- preloader -->
    <style type='text/css'>
        .preloader_bg { position: fixed; background: #fff; width: 100%; height: 100%; top: 0; left: 0; z-index: 100; }
        .preloader_content { position: fixed; left: 50%; top: 50%; transform: translate(-50%,-50%); z-index: 101; }
    </style>
	
    <script type='text/javascript'>
        $(document).ready(function() {
            $('.preloader_bg').fadeOut(500);
            $('.preloader_content').fadeOut(500);
        });
    </script>
	
    <div class='preloader_bg'></div>
    <div class='preloader_content'><p style='display: block; font-size: 2em; margin: auto; text-align: center; color: #222;'>ЗАГРУЗКА...</p></div>
	
    <noscript>
        <style>
            .preloader_bg, .preloader_content { display: none !important; }
        </style>
    </noscript>
    <!-- /preloader -->
	
    <div id='panel_main' style='margin: 20px 12px 20px 12px; display: flex; flex-direction: row; justify-content: flex-start; align-items: flex-start'>
		
		<div style='margin-right: 48px'>
			<table class='report_table'>
				<!-- <tr><td class='right_p'>время запуска:</td><td><span class='text_values'>R_LAUNCH_TIME</span></td></tr> -->
				
				<tr><td class='right_p'><b>СТАРТОВЫЕ ПАРАМЕТРЫ (КОНСТАНТЫ)</b></td><td></td></tr>
				<tr><td class='right_p'>MAX_STAGES * MAX_DAYS_AT_STAGE</td><td><span class='text_values' id='R_STAGES_TOTAL'>R_STAGES_TOTAL</span> * <span class='text_values'>R_DAYS_IN_STAGE</span> = <span class='text_values' id='text_DAYS_TOTAL'>R_DAYS_TOTAL</span></td></tr>
				<tr><td class='right_p'>SLIDING_FREQUENCY</td><td><span class='text_values'>R_SLIDING_FREQUENCY</span></td></tr>
				<tr><td class='right_p'>ROGUES_AT_BEGIN</td><td><span class='text_values'>R_PPL_INITIAL_SIZE</span></td></tr>
				<tr><td class='right_p'>WINS_TO_REPRODUCE</td><td><span class='text_values'>R_WINS_TO_REPRODUCE</span></td></tr>
				<tr><td class='right_p'>DEFEATS_TO_DIE</td><td><span class='text_values'>R_DEFEATS_TO_DIE</span></td></tr>
				<tr><td class='right_p'>POSSIBLE_BIRTH_QUANTITIES</td><td><span class='text_values'>R_POSSIBLE_BIRTH_QUANTITIES</span></td></tr>
				
				<tr><td class='right_p td_padding'><b>полученные данные:</b></td><td></td></tr>
				<tr><td class='right_p'>конечный размер популяции:</td><td><span class='text_values'>R_PPL_FINAL_SIZE</span></td></tr>
				<tr><td class='right_p'>разбойников всего:</td><td><span class='text_values'>R_ROGUES_TOTAL</span></td></tr>
				<tr><td class='right_p'>поколений всего:</td><td><span class='text_values'>R_GNR_TOTAL</span></td></tr>
				<tr><td class='right_p'>битв проведено:</td><td><span class='text_values'>R_BATTLES_TOTAL</span></td></tr>
				<tr><td class='right_p'>ничьих:</td><td><span class='text_values'>R_TIES_TOTAL</span></td></tr>
				<tr><td class='right_p'>макс. период застоя:</td><td><span class='text_values'>R_DWC_TOTAL</span></td></tr>
				<tr><td class='right_p'>день последних изменений:</td><td><span class='text_values'>R_DAY_LAST_CHANGES</span></td></tr>
			</table>
		</div>
		
		<div>
			<table class='report_table'>
				<tr><td class='right_p'>уникальных/возможных генотипов:</td><td><span class='text_values'>R_UNIQUE_GENOTYPES / R_POSSIBLE_GENOTYPES</span></td></tr>
				<tr><td class='right_p'>охват генофонда:</td><td><span class='text_values'>R_GENOTYPES_PERCENT</span></td></tr>
				
				<tr><td class='right_p td_padding'>1-е место:</td><td class='td_padding'><span class='text_values'>R_WINNER_1_NAME</span></td></tr>
				<tr><td class='right_p'>побед у этого гена:</td><td><span class='text_values'>R_WINNER_1_WINS</span></td></tr>
				<tr><td class='right_p'>появился в поколении:</td><td><span class='text_values'>R_WINNER_1_BORN</span></td></tr>
				
				<tr><td class='right_p td_padding'>2-е место:</td><td class='td_padding'><span class='text_values'>R_WINNER_2_NAME</span></td></tr>
				<tr><td class='right_p'>побед у этого гена:</td><td><span class='text_values'>R_WINNER_2_WINS</span></td></tr>
				<tr><td class='right_p'>появился в поколении:</td><td><span class='text_values'>R_WINNER_2_BORN</span></td></tr>
				
				<tr><td class='right_p td_padding'>3-е место:</td><td class='td_padding'><span class='text_values'>R_WINNER_3_NAME</span></td></tr>
				<tr><td class='right_p'>побед у этого гена:</td><td><span class='text_values'>R_WINNER_3_WINS</span></td></tr>
				<tr><td class='right_p'>появился в поколении:</td><td><span class='text_values'>R_WINNER_3_BORN</span></td></tr>
			</table>
		</div>
    </div>
    
	
	
	<div style='margin: 20px 12px 20px 12px;'>
	
		<div style='margin: 4px 0px 10px 0px' align='center'>
			<div style='display: flex; flex-direction: row; justify-content: center; align-items: flex-start;'>
				
				<div class='flex_CFsC' style='margin-right: 20px'>
					<div><p class='title_small'>вручную</p></div>
					<div>
						<div class='flex_RCC' style='margin-top: 6px'>
							<div><span class='btn_change_day' id='btn_day_prev'>&#8592;</span></div>
							<div><input type='range' id='input_range' min='1' max='R_DAYS_DRAWN' value='1'></div>
							<div><span class='btn_change_day' id='btn_day_next'>&#8594;</span></div>
						</div>
					</div>
				</div>
				
				<div class='flex_CFsC' style='margin-left: 20px'>
					<div><p class='title_small'>автоматическое воспроизведение</p></div>
					<div>
						<div class='flex_RCC'>
							<div style='margin-right: 12px'><span class='btn_blue' id='btn_run_from_begin'>запуск сначала</span></div>
							<div style='margin-right: 12px'><span class='btn_blue orange_btn' id='btn_pause'>пауза</span></div>
							<div style='margin-right: 24px'><span class='btn_blue' id='btn_run_from_current'>продолжить</span></div>
							
							<div style='' align='left'>
								<p style='font-size: 0.8em; margin: 0px; padding: 0px'>задержка между слайдами, ms</p>
								<input class='inputs' id='input_delay' value='50' size='4' style='font-size: 0.8em'>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<p style='margin: 16px 0px 8px 0px; font-size: 1.2em'>показывается запечатлённый эпизод: <span class='text_values' id='current_day_showing'>1</span></p>
		</div>
		
		<!-- контейнеры со слайдами, сгенерерированными объектом класса Stats -->
		<div>
			<a class='button_with_text btns_slides_direction button_activated' id='btn_slides_horiz'>горизонтально</a>
			<a class='button_with_text btns_slides_direction' id='btn_slides_verti'>вертикально</a>
			<script>
			$('.btns_slides_direction').click(function(){
				
				$('.btns_slides_direction').removeClass('button_activated');
				$(this).addClass('button_activated');
				
				if( $(this).attr('id') == 'btn_slides_horiz' ){
					$('#div_for_slides').css('flex-direction', 'row');
					$('#div_for_slides').css('align-items', 'flex-start');
				}
				
				if( $(this).attr('id') == 'btn_slides_verti' ){
					$('#div_for_slides').css('flex-direction', 'column');
					$('#div_for_slides').css('align-items', 'center');
				}
			});
			</script>
		</div>
		<div id='div_for_slides' style='display: flex; flex-direction: row; justify-content: center; align-items: flex-start'>
			
			<!-- тут будут визуализациии области генотипов (с точки зрения их распространённости) -->
			<div class='div_for_slide' align='center' style='min-width: 640px'>
				<p class='title_small'>распространённость генотипов</p>
				
				<div style='margin-right: 5px' id='spawner_for_iframes_distribution'>
					R_SLIDES_DISTRIBUTION
				</div>
				
				<div class='div_legend'>
					
					<div>
						<div class='flex_RLC'>
							<span class='gen_legend gen_legend_one' style='background-color: #a5f3e3; box-shadow: 1px 2px 2px #000000;'></span>
							<p class='text_legend' nowrap>изначальный</p>
						</div>
						<div class='flex_RLC'>
							<span class='gen_legend gen_legend_one' style='background-color: #008080'></span>
							<p class='text_legend' nowrap>больше 10 появлений</p>
						</div>
						<div class='flex_RLC'>
							<span class='gen_legend gen_legend_one' style='background-color: #f0f3f4'></span>
							<p class='text_legend' nowrap>не существовал</p>
						</div>
					</div>
					
					<div class='flex_RLC' style='margin-left: 24px'>
						<div class='text_legend' style='margin-right: 8px'><p>меньше появлений</p></div>
						<div><span class='gen_legend' style='background-color: #bcf6ea'></span></div>
						<div><span class='gen_legend' style='background-color: #8ff0dc'></span></div>
						<div><span class='gen_legend' style='background-color: #62eace'></span></div>
						<div><span class='gen_legend' style='background-color: #35e3c1'></span></div>
						<div><span class='gen_legend' style='background-color: #1ccaa7'></span></div>
						<div class='text_legend' style='margin-left: 8px'><p>больше появлений</p></div>
					</div>
				</div>
			</div>
			
			<!-- тут будут визуализациии области генотипов (с точки зрения их побед) -->
			<div class='div_for_slide' align='center' style='min-width: 640px'>
				<p class='title_small'>победы генотипов</p>
				
				<div style='margin-left: 5px' id='spawner_for_iframes_wins'>
					R_SLIDES_WINS
				</div>
				
				<div class='div_legend'>
					
					<div>
						<div class='flex_RLC'>
							<span class='gen_legend gen_legend_one' style='background-color: #ffd6cc'></span>
							<p class='text_legend' nowrap>ни одной победы</p>
						</div>
						<div class='flex_RLC'>
							<span class='gen_legend gen_legend_one' style='background-color: #008080'></span>
							<p class='text_legend' nowrap>20 и более побед</p>
						</div>
						<div class='flex_RLC'>
							<span class='gen_legend gen_legend_one' style='background-color: #f0f3f4'></span>
							<p class='text_legend' nowrap>не существовал</p>
						</div>
					</div>
					
					<div class='flex_RLC' style='margin-left: 24px'>
						<div class='text_legend' style='margin-right: 8px'><p>меньше побед</p></div>
						<div><span class='gen_legend' style='background-color: #c1f0cd'></span></div>
						<div><span class='gen_legend' style='background-color: #98e6ac'></span></div>
						<div><span class='gen_legend' style='background-color: #6fdc8b'></span></div>
						<div><span class='gen_legend' style='background-color: #46d269'></span></div>
						<div><span class='gen_legend' style='background-color: #2db950'></span></div>
						<div class='text_legend' style='margin-left: 8px'><p>больше побед</p></div>
					</div>
				</div>
			</div>
		</div>
		
		<div style='display: flex; flex-direction: row; justify-content: center; align-items: flex-start' align='center'>
			<div style='margin: 20px 0px 20px 0px' align='center'>
				<img src='charts/chart_population_demography.png'>
			</div>
			
			<div style='margin: 20px 0px 20px 0px' align='center'>
				<img src='charts/chart_population_total.png'>
			</div>
		</div>
		
		<div style='display: flex; flex-direction: row; justify-content: center; align-items: flex-start' align='center'>
			<div style='margin: 20px 0px 20px 0px' align='center'>
				<img src='charts/chart_genotypes_variety.png'>
			</div>
			
			<div style='margin: 20px 0px 20px 0px' align='center'>
				<img src='charts/chart_genotypes_ties.png'>
			</div>
		</div>
	</div>
	
	
	
    <script>
		// когда страница готова:
		$(document).ready(function(){
			console.log('OK');
			
			// сделать видимыми фреймы для первого дня:
			$('.d_1').css('display', 'flex');
			$('.w_1').css('display', 'flex');
		});
		
		// выбор дня:
        $('#input_range').on('input', function(){
            $('#current_day_showing').text( $(this).val() );
			
			$('.g_cont_d').css('display', 'none');
			$('.d_' + $(this).val() ).css('display', 'flex');
			
			$('.g_cont_w').css('display', 'none');
			$('.w_' + $(this).val() ).css('display', 'flex');
        });
		
		// переключение дня кнопкой:
		$('.btn_change_day').click(function(){
			
			let current_day = Number( $('#input_range').val() );
			let new_day = 0;
			
			// если предыдущий день:
			if( $(this).attr('id') == 'btn_day_prev' ){
				new_day = current_day - 1;
				if( new_day < 0 ){ new_day = 0; }
			}
			
			// если следующий день:
			if( $(this).attr('id') == 'btn_day_next' ){
				new_day = current_day + 1;
				let max_days = Number( $('#text_DAYS_TOTAL').text() );
				if( new_day > max_days ){ new_day = max_days; }
			}
			
			$('#input_range').val(new_day);
			$('#input_range').trigger('input');
		});
		
		// кнопка - воспроизвести сначала:
		$('#btn_run_from_begin').click(function(){
			
			$('.g_cont_d').css('display', 'none');
			$('.d_' + $(this).val() ).css('display', 'flex');
			
			$('.g_cont_w').css('display', 'none');
			$('.w_' + $(this).val() ).css('display', 'flex');
			
			play_frames_to_the_last(1);
		});
		
		// кнопка - воспроизвести с текущей позиции:
		$('#btn_run_from_current').click(function(){
			
			let current = $('#input_range').val();
			play_frames_to_the_last(current);
		});
		
		// переменная для управления воспроизведением (автоматическим переключением) слайдов:
		var SWITCHER = '';
		
		// начать воспроизведение с указанного слайда и до самого последнего:
		function play_frames_to_the_last(current){
			
			let delay = $('#input_delay').val();
			
			clearInterval(SWITCHER);
			$('#btn_pause').removeClass('orange_btn');
			
			SWITCHER = setInterval(function(){
				
				$('#input_range').val(current);
				$('#input_range').trigger('input');
				
				current++;
				
				if( current > Number( $('#input_range').attr('max') ) ){
				
					clearInterval(SWITCHER);
					$('#btn_pause').addClass('orange_btn');
				}
			}, delay);
		}
		
		// кнопка - поставить воспроизведение на паузу:
		$('#btn_pause').click(function(){
			
			clearInterval(SWITCHER);
			$('#btn_pause').addClass('orange_btn');
		});
		
		// наведён курсор на иконку генотипа:
		$('body').on('mouseenter', '.gen', function(event){
			
			$('.tooltip_block').html('<span>'+ $(this).attr('id') + '</span>');
			$('.tooltip_block').css('display', 'block');
			$('.tooltip_block').offset({
				top: $(this).offset().top - $('.tooltip_block').height() - 16,
				left: $(this).offset().left - $('.tooltip_block').width() - 16
			});
		});
		
		// убран курсор с иконки генотипа:
		$('body').on('mouseleave', '.gen', function(event){
			$('.tooltip_block').css('display', 'none');
		});
    </script>
	
</body>
</html>
